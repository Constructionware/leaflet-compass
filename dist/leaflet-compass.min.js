/* 
 * Leaflet Control Compass v1.1.0 - 2016-10-29 
 * 
 * Copyright 2014 Stefano Cudini 
 * stefano.cudini@gmail.com 
 * http://labs.easyblog.it/ 
 * 
 * Licensed under the MIT license. 
 * 
 * Demos: 
 * http://labs.easyblog.it/maps/leaflet-compass/ 
 * 
 * Source: 
 * git@github.com:stefanocudini/leaflet-compass.git 
 * 
 */
!function(a){if("function"==typeof define&&define.amd)define(["leaflet"],a);else if("undefined"!=typeof module)module.exports=a(require("leaflet"));else{if("undefined"==typeof window.L)throw"Leaflet must be loaded first";a(window.L)}}(function(a){return a.Control.Compass=a.Control.extend({includes:a.Mixin.Events,options:{autoActive:!0,textErr:null,callErr:null,showDigit:!1,position:"topright"},initialize:function(b){b&&b.style&&(b.style=a.Util.extend({},this.options.style,b.style)),a.Util.setOptions(this,b),this._errorFunc=this.options.callErr||this.showAlert,this._isActive=!1,this._firstMoved=!1,this._currentAngle=null},onAdd:function(b){this._map=b;var c=a.DomUtil.create("div","leaflet-compass");return this._button=a.DomUtil.create("span","compass-button",c),this._button.href="#",this._divcompass=a.DomUtil.create("div","compass-icon",this._button),this._divcompass.src="images/compass-icon.png",this._digit=a.DomUtil.create("span","compass-digit",this._button),a.DomEvent.on(this._button,"click",a.DomEvent.stop,this).on(this._button,"click",this._switchCompass,this),this._alert=a.DomUtil.create("div","compass-alert",c),this._alert.style.display="none",this._map.on("anglefound",this._rotateCompass,this).on("angleerror",this._errorCompass,this),this.options.autoActive&&this.activate(),c},onRemove:function(a){this.deactivate()},_switchCompass:function(){this._isActive?this.deactivate():this.activate()},getAngle:function(){return this._currentAngle},_debouncer:function(a){var b;return function(){var c=this,d=arguments;clearTimeout(b),b=setTimeout(function(){a.apply(c,Array.prototype.slice.call(d))},300)}},activate:function(){this._isActive=!0,this._divcompass.style.display="block";var a=this;window.addEventListener("deviceorientation",function(b){var c;b.webkitCompassHeading?c=360-b.webkitCompassHeading:b.alpha&&(c=b.alpha),a._rotateCompass(c)},!1),this.fire("compass_activated")},_rotateCompass:function(b){this.options.showDigit&&!isNaN(parseFloat(b))&&isFinite(b)&&(this._digit.innerHTML=b.toFixed(1)),this._divcompass.style.webkitTransform="rotate("+b+"deg)",this._divcompass.style.MozTransform="rotate("+b+"deg)",this._divcompass.style.transform="rotate("+b+"deg)",this._currentAngle=b,this.fire("compasslocated",{angle:b}),a.DomUtil.addClass(this._button,"active")},_errorCompass:function(a){this.deactivate(),this._errorFunc.call(this,this.options.textErr||a.message)},deactivate:function(){this._isActive=!1,this._firstMoved=!1,a.DomUtil.removeClass(this._button,"active"),this.fire("compass_deactivated")},showAlert:function(a){this._alert.style.display="block",this._alert.innerHTML=a;var b=this;clearTimeout(this.timerAlert),this.timerAlert=setTimeout(function(){b._alert.style.display="none"},2e3)}}),a.control.compass=function(b){return new a.Control.Compass(b)},a.Control.Compass});